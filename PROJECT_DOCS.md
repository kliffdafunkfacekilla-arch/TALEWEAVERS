# TALEWEAVERS: Comprehensive Project Documentation

## 1. Project Mission
TALEWEAVERS is a unified TTRPG ecosystem designed to collapse the distance between deep world simulation (C++), adaptive AI game mastering (Python), and high-performance visual interfaces (React/PixiJS). It uses a "Simulation-First" approach where every bit of lore is grounded in a physical, temporal, and spatial world state.

---

## 2. Core Repositories
- **TALEWEAVERS (Main Hub)**: Contains the SAGA Brain (AI), VTT Frontend, and Data Management.
- **FantasyLloreAndWorldSimulator (Headless Engine)**: High-performance C++ simulation core using SoA (Structure of Arrays) for planetary-scale world logic.

---

## 3. Technology Stack
| Layer | Technology | Responsibility |
| :--- | :--- | :--- |
| **Simulation Core** | C++17 | Biome simulation, Faction AI, Pathfinding, History Logging. |
| **Logic (Brain)** | Python 3.10+ | FastAPI, ECS (Entity Component System), RAG (Retrieval-Augmented Generation). |
| **Persistence** | SQLite | Active world state, entity data, and spatial indexing. |
| **Narrative** | LangChain / LLM | Intent resolution, Storytelling, Context management. |
| **Frontend** | React + PixiJS | 60fps WebGL/Canvas map rendering, Agent controls. |
| **World Building** | Obsidian (MD) | Designer-facing lore entry and metadata tagging. |

---

## 4. Key Systems Audit

### 4.1. The Simulation Pipeline (SAGA v2)
1.  **C++ Engine**: Generates a 1,000,000 cell world map using Whittaker biomes. It simulates years of faction expansion and war.
2.  **LoreScribe**: During simulation, this module creates "Atomic Lore Piece" JSON files in `data/lore/history/`.
3.  **ETL Sync**: The Python `WorldImporter` reads the simulation results and populates the SQLite `world_state.db`.

### 4.2. SAGA Brain (The Controller)
- **ECS (Entity Component System)**: Located in `core/ecs.py`. It uses a composition-over-inheritance model. Entities are UUIDs with components like `Position`, `Vitals`, and `Stats`.
- **RAG Engine**: Located in `core/rag.py`. It uses a hybrid keyword/spatial search. It prioritizing lore based on the player's proximity to world coordinates.
- **Vault Compiler**: Located in `tools/vault_compiler.py`. It turns Obsidian notes (Markdown + YAML) into game-ready database entries and procedurally seeds the map.

### 4.3. World Architect (The Interface)
- A specialized React component (`vtt/src/components/WorldArchitect.tsx`) that provides:
    - **Landscape Painting**: Brushes for modifying biomes in real-time.
    - **Entity Placement**: Drag-and-drop character and faction seeding.
    - **Timeline Scrubbing**: Loading historical snapshots (snapshots saved by C++ simulation).
    - **Vault Sync**: One-click ingestion of Obsidian notes into the simulation.

---

## 5. Directory Manifesto
- `/brain`: The SAYA (SAGA Brain API) server and tactical mechanics.
- `/core`: Shared library for ECS, RAG, Database, and Rules.
- `/data`:
    - `/lore`: Categorized atomic lore files (History, Biology, Factions, etc.).
    - `world_state.db`: The master SQLite database for the active game.
    - `world_grid.json`: The visual representation of the current world map.
- `/vtt`: React frontend and PixiJS rendering engine.
- `/tools`: Utility scripts for syncing, auditing, and compiling.

---

## 6. Audit Conclusion & Recommendations
**Current Status**: **PHASE 2 (LOGIC)**. The foundation for ECS and RAG is complete. The "Vault-to-Engine" pipeline is operational.

**Recommendations**:
1.  **Data Consolidation**: Delete `data/lore.json` once the `data/lore/` atomic folder is fully populated to avoid "Split-Brain" lore issues.
2.  **Router Refactoring**: Break `brain/server.py` into `architect_router.py`, `tactical_router.py`, and `narrative_router.py`.
3.  **Vector Store**: Finalize the vector embedding migration (ChromaDB) for truer semantic search in the RAG engine.
4.  **Premium Polish**: Implement more subtle micro-animations in the `MapCanvas` when entities move or take damage.

---
*Documentation generated by Antigravity AI - 2026-02-19*
